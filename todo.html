<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aplikasi Todo List</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-3">Todo List</h1>
      <hr />

      <!-- Form Tambah -->
      <form id="formData" class="mb-3">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            name="todo"
            placeholder="Tambah todo baru..."
          />
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-plus"></i> Tambah
          </button>
        </div>
      </form>

      <!-- Filter dan Search -->
      <div class="d-flex justify-content-between mb-3">
        <div>
          <select id="filter" class="form-select">
            <option value="all">Semua</option>
            <option value="completed">Selesai</option>
            <option value="pending">Belum Selesai</option>
          </select>
        </div>
        <div>
          <input
            type="text"
            id="search"
            class="form-control"
            placeholder="Cari todo..."
          />
        </div>
      </div>

      <!-- List Todo -->
      <ul class="list-group" id="todoList"></ul>
    </div>

    <script>
      let todos = [];

      function renderTodos() {
        const todoList = document.getElementById("todoList");
        const filter = document.getElementById("filter").value;
        const search = document.getElementById("search").value.toLowerCase();
        todoList.innerHTML = "";

        todos
          .filter((item) => {
            if (filter === "completed" && !item.completed) return false;
            if (filter === "pending" && item.completed) return false;
            return true;
          })
          .filter((item) => item.todo.toLowerCase().includes(search))
          .forEach((item, index) => {
            const li = document.createElement("li");
            li.className = "list-group-item d-flex align-items-center";

            const div = document.createElement("div");
            div.className = "flex-fill";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "form-check-input me-2";
            checkbox.checked = item.completed;
            checkbox.addEventListener("change", () => {
              item.completed = checkbox.checked;
              saveTodos();
              renderTodos();
            });

            const label = document.createElement("span");
            label.textContent = item.todo;
            label.style.textDecoration = item.completed
              ? "line-through"
              : "none";

            div.appendChild(checkbox);
            div.appendChild(label);

            // Tombol edit
            const editBtn = document.createElement("button");
            editBtn.className = "btn btn-sm btn-outline-secondary me-2";
            editBtn.innerHTML = '<i class="bi bi-pencil"></i>';
            editBtn.addEventListener("click", () => {
              const newTodo = prompt("Ubah todo:", item.todo);
              if (newTodo && newTodo.trim() !== "") {
                if (
                  todos.some(
                    (t, i) =>
                      t.todo.toLowerCase() === newTodo.toLowerCase() &&
                      i !== index
                  )
                ) {
                  alert("Todo dengan judul yang sama sudah ada!");
                  return;
                }
                item.todo = newTodo.trim();
                saveTodos();
                renderTodos();
              }
            });

            // Tombol hapus
            const deleteBtn = document.createElement("button");
            deleteBtn.className = "btn btn-sm btn-outline-danger";
            deleteBtn.innerHTML = '<i class="bi bi-trash"></i>';
            deleteBtn.addEventListener("click", () => {
              todos.splice(index, 1);
              saveTodos();
              renderTodos();
            });

            li.appendChild(div);
            li.appendChild(editBtn);
            li.appendChild(deleteBtn);
            todoList.appendChild(li);
          });
      }

      function saveTodos() {
        localStorage.setItem("todos", JSON.stringify(todos));
      }

      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("formData");

        // Load dari localStorage
        const storedTodos = localStorage.getItem("todos");
        if (storedTodos) {
          todos = JSON.parse(storedTodos);
        }

        // Tambah todo
        form.addEventListener("submit", function (event) {
          event.preventDefault();
          const todoInput = form.todo.value.trim();

          if (todoInput === "") {
            alert("Todo tidak boleh kosong!");
            return;
          }

          if (
            todos.some(
              (item) => item.todo.toLowerCase() === todoInput.toLowerCase()
            )
          ) {
            alert("Todo dengan judul yang sama sudah ada!");
            return;
          }

          todos.unshift({
            todo: todoInput,
            completed: false,
          });

          form.todo.value = "";
          saveTodos();
          renderTodos();
        });

        // Filter & Search
        document
          .getElementById("filter")
          .addEventListener("change", renderTodos);
        document
          .getElementById("search")
          .addEventListener("input", renderTodos);

        renderTodos();
      });
    </script>
  </body>
</html>
